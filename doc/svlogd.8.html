


<html>
<head>
<title>svlogd(8) manual page</title>
</head>
<body bgcolor='white'>
<a href='http://smarden.org/pape/'>G. Pape</a><br><a href='index.html'>runit</A><hr><p>

<h2><a name='sect0'>Name</a></h2>
svlogd - runit&rsquo;s service logging daemon 
<h2><a name='sect1'>Synopsis</a></h2>
<b>svlogd</b> [-tv] [-r <i>c]</i> [-R
<i>xyz]</i> [-l <i>n]</i> [-b <i>n]</i> <i>logs</i> 
<h2><a name='sect2'>Description</a></h2>
<i>logs</i> consists of one or more arguments,
each specifying a directory. <p>
<b>svlogd</b> continuously reads log data from its
standard input, optionally filters log messages, and writes the data to
one or more automatically rotated <i>logs</i>. <p>
Recent log files can automatically
be processed by an arbitrary processor program when they are rotated, and
<b>svlogd</b> can be told to alert selected log messages to standard error. <p>
<b>svlogd</b>
runs until it sees end-of-file on standard input or is sent a TERM signal,
see below. 
<h3><a name='sect3'>Log Directory</a></h3>
A log directory <i>log</i> contains some number of old
log files, and the current log file <i>current</i>. Old log files have a file name
starting with <i>@</i> followed by a precise timestamp (see <i><b>tai64n</b>(8)</i>), indicating
when <i>current</i> was rotated and renamed to this file. <p>
A log directory additionally
contains the lock file <i>lock</i>, maybe <i>state</i> and <i>newstate</i>, and optionally the
file <i>config</i>. <b>svlogd</b> creates necessary files if they don&rsquo;t exist. <p>
If <b>svlogd</b>
has trouble opening a log directory, it prints a warning, and ignores this
log directory. If <b>svlogd</b> is unable to open all log directories given at
the command line, it exits with an error. This can happen on start-up or
after receiving a HUP signal. 
<h3><a name='sect4'>Log File Rotation</a></h3>
<b>svlogd</b> appends selected log
messages to the <i>current</i> log file. If <i>current</i> has <i>size</i> bytes or more size
(or there is a new-line within the last <i>len</i> of <i>size</i> bytes) <i>current</i> is rotated:
<p>
<b>svlogd</b> closes <i>current</i>, changes permission of <i>current</i> to 0755, renames <i>current</i>
to @<i>timestamp.s,</i> and starts with a new empty <i>current</i>. If <b>svlogd</b> sees <i>num</i>
or more old log files in <i>dir</i>, it removes the oldest. 
<h3><a name='sect5'>Processor</a></h3>
If <b>svlogd</b>
is told to process recent log files, it saves <i>current</i> to @<i>timestamp.u,</i> feeds
@<i>timestamp.u</i> through &lsquo;&lsquo;sh -c "<i>processor</i>"&rsquo;&rsquo; and writes the output to @<i>timestamp.t.</i>
If the <i>processor</i> finishes successfully, @<i>timestamp.u</i> is deleted and @<i>timestamp.t</i>
is renamed to @<i>timestamp.s,</i> otherwise @<i>timestamp.t</i> is deleted and the <i>processor</i>
is started again. <b>svlogd</b> also saves any output that the <i>processor</i> writes
to file descriptor 5, and make that output available on file descriptor
4 when it runs <i>processor</i> on the next log file rotation. <p>
A <i>processor</i> is run
in the background. If <b>svlogd</b> sees a previously started <i>processor</i> still running
when trying to start a new one for the same <i>log</i>, it blocks until the currently
running <i>processor</i> has finished successfully. Only the HUP signal works in
that situation. Note that this may block any program feeding its log data
to <b>svlogd.</b> 
<p> 
<h3><a name='sect6'>Config</a></h3>
On startup, and after receiving a HUP signal, <b>svlogd</b> checks
for each <i>log</i> if the configuration file <i>log/config</i> exists, and if so, reads
the file line by line and adjusts configuration for <i>log</i> as follows: <p>
If
the line is empty, less than two characters long, or starts with a &lsquo;&lsquo;#&rsquo;&rsquo;, it
is ignored. A line of the form 
<dl>

<dt>s<i>size</i> </dt>
<dd>sets the maximum file size of <i>current</i>
when <b>svlogd</b> should rotate the current log file to <i>size</i> bytes. Default is
1000000. If <i>size</i> is zero, <b>svlogd</b> doesn&rsquo;t rotate log files. You should set
<i>size</i> to at least (2 * <i>len</i>). </dd>

<dt>n<i>num</i> </dt>
<dd>sets the maximum number of old log files
<b>svlogd</b> should maintain to <i>num</i>. If <b>svlogd</b> sees more that <i>num</i> old log files
in <i>log</i> after log file rotation, it deletes the oldest one. Default is 10.
</dd>

<dt>!<i>processor</i> </dt>
<dd>tells <b>svlogd</b> to feed each recent log file through <i>processor</i>
(see above) on log file rotation. By default log files are not processed.
</dd>
</dl>
<p>
If a line starts with a <i>-</i>, <i>+</i>, <i>e</i>, or <i>E</i>, <b>svlogd</b> matches the first <i>len</i> characters
of each log message against <i>pattern</i> and acts accordingly: 
<dl>

<dt>-<i>pattern</i> </dt>
<dd>the log
message is deselected. </dd>

<dt>+<i>pattern</i> </dt>
<dd>the log message is selected </dd>

<dt>e<i>pattern</i> </dt>
<dd>log
messages matching <i>pattern</i> are printed to standard error. </dd>

<dt>E<i>pattern</i> </dt>
<dd>log messages
not matching <i>pattern</i> are printed to standard error. </dd>
</dl>
<p>
Initially each line
is selected. Deselected log messages are discarded from <i>log</i>. 
<h2><a name='sect7'>Pattern Matching</a></h2>
<b>svlogd</b>
matches a log message against the string <i>pattern</i> as follows: <p>
<i>pattern</i> is
applied to the log message one character by one, starting with the first.
A character not a star (&lsquo;&lsquo;*&rsquo;&rsquo;) and not a plus (&lsquo;&lsquo;+&rsquo;&rsquo;) matches itself. A plus matches
the next character in <i>pattern</i> in the log message one or more times. A star
before the end of <i>pattern</i> matches any string in the log message that does
not include the next character in <i>pattern</i>. A star at the end of <i>pattern</i>
matches any string. 
<h2><a name='sect8'>Options</a></h2>

<dl>

<dt><b>-t</b> </dt>
<dd>timestamp. Prefix each selected line with a
precise timestamp (see <i><b>tai64n</b>(8)</i>) when writing to <i>log</i> or to standard error.
</dd>

<dt><b>-r <i>c</b> </i></dt>
<dd>replace. <i>c</i> must be a single character. Replace non-printable characters
in log messages with <i>c</i>. Characters are replaced before pattern matching
is applied. </dd>

<dt><b>-R <i>xyz</b> </i></dt>
<dd>replace charset. Additionally to non-printable characters,
replace all characters found in <i>xyz</i> with <i>c</i> (default &lsquo;&lsquo;_&rsquo;&rsquo;). </dd>

<dt><b>-l <i>len</b> </i></dt>
<dd>line length.
Pattern matching applies to the first <i>len</i> characters of a log message only.
Default is 1000. </dd>

<dt><b>-b <i>buflen</b> </i></dt>
<dd>buffer size. Set the size of the buffer <b>svlogd</b>
uses when reading from standard input and writing to <i>logs</i> to <i>buflen</i>. Default
is 1024. <i>buflen</i> must be greater than <i>len</i>. </dd>

<dt><b>-v</b> </dt>
<dd>verbose. Print verbose messages
to standard error. </dd>
</dl>

<h2><a name='sect9'>Signals</a></h2>
If <b>svlogd</b> is sent a HUP signal, it closes and
reopens all <i>logs</i>, and updates their configuration according to <i>log/config</i>.
If <b>svlogd</b> has trouble opening a log directory, it prints a warning, and
discards this log directory. If <b>svlogd</b> is unable to open all log directories
given at the command line, it exits with an error. <p>
If <b>svlogd</b> is sent a TERM
signal, or if it sees end-of-file on standard input, it stops reading standard
input, processes the data in the buffer, waits for all <i>processor</i> subprocesses
to finish if any, and exits 0 as soon as possible. <p>
If <b>svlogd</b> is sent an
ALRM signal, it forces log file rotation for all <i>logs</i> with a non empty
<i>current</i> log file. 
<h2><a name='sect10'>See Also</a></h2>
<i>runsv(8)</i>, <i>runsvstat(8)</i>, <i>runsvctrl(8)</i>, <i>runsvdir(8)</i>,
<i>runsvchdir(8)</i>, <i>runit(8)</i>, <i>runit-init(8)</i>, <i>multilog(8)</i> <p>
<i>http://smarden.org/runit/</i>

<h2><a name='sect11'>Author</a></h2>
Gerrit Pape &lt;pape@smarden.org&gt; <p>

<hr><p>
<a name='toc'><b>Table of Contents</b></a><p>
<ul>
<li><a name='toc0' href='#sect0'>Name</a></li>
<li><a name='toc1' href='#sect1'>Synopsis</a></li>
<li><a name='toc2' href='#sect2'>Description</a></li>
<ul>
<li><a name='toc3' href='#sect3'>Log Directory</a></li>
<li><a name='toc4' href='#sect4'>Log File Rotation</a></li>
<li><a name='toc5' href='#sect5'>Processor</a></li>
<li><a name='toc6' href='#sect6'>Config</a></li>
</ul>
<li><a name='toc7' href='#sect7'>Pattern Matching</a></li>
<li><a name='toc8' href='#sect8'>Options</a></li>
<li><a name='toc9' href='#sect9'>Signals</a></li>
<li><a name='toc10' href='#sect10'>See Also</a></li>
<li><a name='toc11' href='#sect11'>Author</a></li>
</ul>
</body>
</html>
