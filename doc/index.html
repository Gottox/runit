<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>
<head>
<title>runit - a UNIX init scheme with service supervision</title>
</head>
<body>
<a href="http://smarden.org/pape/">G. Pape</a>
<hr>
<h1>runit - a UNIX init scheme with service supervision</h1>
<hr>
<a href="install.html">How to install runit</a><br>
<a href="upgrade.html">Upgrading from previous versions of runit</a><br>
<a href="replaceinit.html">How to replace init</a><br>
<a href="usedietlibc.html">How to use dietlibc</a>
<p>
<a href="runlevels.html">Runlevels</a><br>
<a href="http://smarden.org/pape/djb/daemontools/noinit.html">
Dependencies</a><br>
<a href="runscripts.html">A collection of run scripts</a><br>
<p>
<a href="runit.8.html">The <tt>runit</tt> program</a><br>
<a href="runit-init.8.html">The <tt>runit-init</tt> program</a><br>
<br>
<a href="runsvdir.8.html">The <tt>runsvdir</tt> program</a><br>
<a href="runsv.8.html">The <tt>runsv</tt> program</a><br>
<a href="runsvchdir.8.html">The <tt>runsvchdir</tt> program</a><br>
<br>
<a href="utmpset.8.html">The <tt>utmpset</tt> program</a><br>
<a href="svwaitdown.8.html">The <tt>svwaitdown</tt> program</a><br>
<a href="svwaitup.8.html">The <tt>svwaitup</tt> program</a><br>
<br>
<a href="runsvstat.8.html">The <tt>runsvstat</tt> program</a>
(not installed by default)<br>
<a href="runsvctrl.8.html">The <tt>runsvctrl</tt> program</a>
(not installed by default)
<hr>
<i>runit</i> is a
<a href="http://cr.yp.to/daemontools.html">daemontools</a> alike
replacement for
<a href="ftp://ftp.cistron.nl/pub/people/miquels/sysvinit/">sysvinit</a>
and other init schemes. <i>runit</i> runs on <b>Debian GNU/Linux</b>,
<b>OpenBSD 2.9</b>, <b>FreeBSD 4.4</b>. <i>runit</i> reportedly runs on
<b>FreeBSD 4.3</b>, and can easily be adapted to other unix operating
systems. If <i>runit</i> runs for you on any other operating system or
linux distribution, please let me know.
<p>
<b>Warning:</b> Replacing <i>sysvinit</i> or <i>init</i> can cause the
system's boot to fail. Make sure you are able to recover and repair your
system, for example if you run a boot loader, it should be able to pass
<tt>init=/bin/sh</tt> to the kernel.
<hr>
<i>runit</i> is discussed on the
<a href="http://skarnet.org/lists/#supervision">
&lt;supervision@list.skarnet.org&gt;</a>
mailing list. To subscribe send an empty email to
<a href="mailto:supervision-subscribe@list.skarnet.org">
&lt;supervision-subscribe@list.skarnet.org&gt;</a>.
<hr>
The command <a href="runit.8.html">runit</a> is intended to run as Unix
process no 1, it is automatically started by the
<a href="runit-init.8.html">runit-init</a> <tt>/sbin/init</tt>-replacement
if this is started by the kernel.
<p>
<a href="runit.8.html">runit</a> performs the system's <i>booting</i>,
<i>running</i> and <i>shutting down</i> in <b>three stages</b>:
<ul>
  <li><b>Stage 1:</b><br>
  <i>runit</i> starts <tt>/etc/runit/1</tt> and waits for it to
  terminate. The system's one time initialization tasks are done here.
  <tt>/etc/runit/1</tt> has full control of <tt>/dev/console</tt> to be
  able to start an emergency shell if the one time initialization tasks
  fail.
  <li><b>Stage 2:</b><br>
  <i>runit</i> starts <tt>/etc/runit/2</tt> which should not return
  until the system is going to halt or reboot, if it crashes, it will be
  restarted. Normally, <tt>/etc/runit/2</tt> runs
  <a href="runsvdir.8.html">runsvdir</a>.
  In Stage 2 <i>runit</i> optionally handles an INT signal
  (ctrl-alt-del keyboard request on Linux/i386).
  <li><b>Stage 3:</b><br>
  If <i>runit</i> is told to halt or reboot the system, or the Stage 2
  returns without errors, it terminates Stage 2 if it is running and runs
  <tt>/etc/runit/3</tt>. The systems tasks to shutdown and halt or
  reboot are done here.
</ul>
These are working examples for debian woody:
<a href="debian/1">/etc/runit/1</a>,
<a href="debian/2">/etc/runit/2</a>,
<a href="debian/3">/etc/runit/3</a>.
<p>
The command <a href="runit-init.8.html">runit-init</a> is intended to
replace <tt>/sbin/init</tt>. sysvinit's command <tt>shutdown</tt> will
keep working. On *BSD systems use <b><tt>init 0</tt></b> for system halt
and <b><tt>init 6</tt></b> for reboot. Runlevels are not implemented in
this Unix process no 1, such can easily be done in other programs, see
<a href="http://smarden.org/pape/djb/daemontools/noinit.html">
Dependencies and runlevels</a>
for an example, the amount of code in process no 1 should be minimal.
<hr>
<b><i>runit</i> in use</b>: I replaced <i>sysvinit</i> with <i>runit</i>
on several server systems and a laptop running Debian/GNU Linux sarge, woody
and potato, and did not encounter any problems. Of course also the
<tt>smarden.org</tt> content server is running with <i>runit</i> as process
no 1. This is from the second machine where I replaced <i>sysvinit</i> with
<i>runit</i>:
<pre>
  # strings /proc/1/exe |grep Id
  &#36;Id: runit.c,v 1.5 2001/12/30 16:28:53 pape Exp &#36;
  # uptime
   14:59:36 up 240 days, 21:10,  2 users,  load average: 0.00, 0.00, 0.00
  # ps axuw |head
  USER       PID %CPU %MEM   VSZ  RSS TTY      STAT START   TIME COMMAND
  root         1  0.0  0.0    24   24 ?        S     2001   0:06 runit
  root         2  0.0  0.0     0    0 ?        SW    2001   0:12 [kflushd]
  root         3  0.0  0.0     0    0 ?        SW    2001   0:14 [kupdate]
  root         4  0.0  0.0     0    0 ?        SW    2001   1:09 [kswapd]
  root         5  0.0  0.0     0    0 ?        SW    2001   0:00 [keventd]
  root       149  0.0  0.1  1692  120 ?        S     2001   0:00 /usr/sbin/cron
  root       152  0.0  0.0  2196    0 ?        SW    2001   0:00 [svscanboot]
  root       154  0.0  0.1  1316  104 ?        S     2001   0:00 svscan /service
  root       155  0.0  0.0  1268   16 ?        S     2001   0:00 readproctitle service errors: ................
  # pstree
  runit-+-cron
        |-keventd
        |-kflushd
        |-kswapd
        |-kupdate
        `-svscanboot-+-readproctitle
                     `-svscan-+-5*[supervise---tcpserver]
                              |-18*[supervise---multilog]
                              |-supervise---qmail-send-+-qmail-clean
                              |                        |-qmail-lspawn
                              |                        `-qmail-rspawn
                              |-supervise---sshd---sshd---sshd---bash---bash---ps
                              |-supervise---bash
                              |-2*[supervise---getty]
                              |-supervise---dhcpd-2.2.x
                              |-supervise---dnscache
                              |-supervise---tinydns
                              |-supervise---isdnlog
                              |-supervise---sleep
                              |-supervise---klogd
                              |-2*[supervise]
                              |-2*[supervise---vboxgetty]
                              |-supervise---clockspeed
                              |-supervise---squid---unlinkd
                              |-supervise---dhclient-2.2.x
                              |-2*[supervise---socklog]
                              `-supervise---uncat
</pre>
This is a more busy system:
<pre>
  # strings /proc/1/exe |grep Id
  &#36;Id: runit.c,v 1.6 2002/01/29 18:56:36 pape Exp &#36;
  # uptime
   15:04:34 up 201 days, 15:34,  3 users,  load average: 0.08, 0.03, 0.01
  # ps axuw |head
  USER       PID %CPU %MEM   VSZ  RSS TTY      STAT START   TIME COMMAND
  root         1  0.0  0.0    24    0 ?        SW   Feb07   0:05 runit
  root         2  0.0  0.0     0    0 ?        SW   Feb07   0:01 [keventd]
  root         3  0.0  0.0     0    0 ?        SW   Feb07   1:45 [kapm-idled]
  root         4  0.0  0.0     0    0 ?        SWN  Feb07   1:21 [ksoftirqd_CPU0]
  root         5  0.0  0.0     0    0 ?        SW   Feb07  31:40 [kswapd]
  root         6  0.0  0.0     0    0 ?        SW   Feb07   0:06 [bdflush]
  root         7  0.0  0.0     0    0 ?        SW   Feb07  14:26 [kupdated]
  root        53  0.0  0.0     0    0 ?        SW   Feb07   0:00 [msp3410 [auto]]
  daemon     115  0.0  0.0  1412    0 ?        SW   Feb07   0:00 /sbin/portmap
</pre>
<hr>
See <a href="install.html">How to install runit</a> for installing
<i>runit</i> and <a href="replaceinit.html">How to replace init</a> for
smoothly escaping from <i>sysvinit</i>.
<hr>
If <i>runit</i> on linux is compiled and linked with
<a href="http://www.fefe.de/dietlibc/">dietlibc</a> it yields in a statically
linked <tt>runit</tt> binary of 14k size and this <tt>ps axuw</tt> output
on my system:
<pre>
  USER       PID %CPU %MEM   VSZ  RSS TTY      STAT START   TIME COMMAND
  root         1  0.0  0.0    24   20 ?        S    Nov22   0:01 runit
</pre>
I recommend doing this; for instructions, see
<a href="usedietlibc.html">How to use dietlibc</a>.
<hr>
See <a href="http://smarden.org/runit/">http://smarden.org/runit/</a>
for recent informations.
<hr>
Related links:
<ul>
  <li><a href="http://www.fefe.de/minit/">minit</a>
  <li><a href="http://multivac.cwru.edu/svscan-1/">svscan as process 1</a>
  <li><a href="ftp://ftp.cistron.nl/pub/people/miquels/sysvinit/">
  sysvinit</a>
  <li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sbin/init/">
  OpenBSD's init</a>
  <li><a href="http://www.freebsd.org/cgi/cvsweb.cgi/src/sbin/init/">
  FreeBSD's init</a>
  <li><a href="http://www.atnf.csiro.au/~rgooch/linux/boot-scripts/">
  Richard Gooch's Linux Boot Scripts</a>
</ul>
<hr>
<address><a href="mailto:pape@smarden.org">
Gerrit Pape &lt;pape@smarden.org&gt;
</a></address>
<small>$Id$</small>
</body>
</html>
